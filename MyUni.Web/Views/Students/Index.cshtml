@using System.Web.Mvc.Html
@using MyUni.Business

@model IEnumerable<Student>

@{
    ViewBag.Title = "Students";
}


<script id="tmpActions" type="text/template">
    <div class="btn-group" role="group">
        <button type="button" class="editBtn btn btn-sm btn-primary" onclick="editBtnClick(this)">
            <i class="fa fa-edit"></i>
            &nbsp;Edit
        </button>
        <button type="button" class="btn btn-sm btn-info">
            <i class="fa fa-info"></i>
            &nbsp;Details
        </button>
        <button type="button" class="btn btn-sm bg-red-gradient ">
            <i class="fa fa-close"></i>
            &nbsp;Delete
        </button>        
    </div>
</script>

<div class="col-sm-12">
    <div class="box box-info box-solid">
        <div class="box-header with-border">
            <h3 class="box-title">Students</h3>
        </div><!-- /.box-header -->
        <div class="box-body">
            <div class="col-sm-3 no-left-padding">
                <div class="input-group input-group-sm">
                    <input type="text" id="search" name="search" class="form-control" placeholder="Search&hellip;">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-info btn-flat">
                            <i class="fa fa-search"></i>
                        </button>
                    </span>
                </div>
            </div>
            @*<div class="col-sm-9"></div>*@
            <div class="clearfix visible-sm-block"></div>
            <hr />
            <p>
                <a href="@Url.Action("Create")" class="btn btn-warning">
                    <i class="fa fa-plus"></i>
                    &nbsp;Add New Student
                </a>
            </p>
            <div>
                @{ Html.RenderPartial("_studentsView", Model); }
            </div>

        </div>
    </div>
</div>



@section scripts
{
    @Scripts.Render("~/bundles/jqueryval");

    <script id="tmpActions" type="text/template">
        <span>XXX</span>
    </script>

    <script type="text/javascript">

        function editBtnClick(e) {
            debugger;
            var test = $(e).closest('tr').data('FirstName');
        }

        $(function () {

            $('#search').bind('keypress', function (e) {
                var key = e.which;

                if (key === 13) {
                    var dataTable = $('#tblStudentsView').DataTable();
                    var url = $('#tblStudentsView').data('url') + "?search=" + $('#search').val();
                    dataTable.ajax.url(url).load();
                }
            });

           

            var studentsView = $("#tblStudentsView").DataTable({
                columns: [
                    { data: "FirstName" },
                    { data: "LastName" },
                    {
                        data: "EnrolledDate",
                        render: function (dateObj) {
                            //
                            // To format the date properly
                            //  http://stackoverflow.com/questions/726334/asp-net-mvc-jsonresult-date-format
                            //
                            var oDate = new Date(parseInt(dateObj.substr(6)));//new Date(dateObj.aData[0]);
                            var result = oDate.getDate() + "/" + (oDate.getMonth() + 1) + "/" + oDate.getFullYear();
                            return "<span>" + result + "</span>";
                        }
                    },
                    {
                        data: null,
                        sortable:false,
                        render:function(dataObj) {
                            return $('#tmpActions').html();
                        }
                    }
                ],
                "paging": true,
                "lengthChange": false,
                "searching": false,
                "autoWidth": true,
                //"searchable":false,
                "processing": true,
                "serverSide": true,
                "ajax": "@Url.Action("GetStudents")"
            });

            //$('.editBtn #tblStudentsView').bind('click', function (e) {
            //    var test =  $(event.target).closest('tr').data('FirstName');
            //});

            $('#tblStudentsView table tbody tr .editBtn').on('click', function(e) {
                debugger;
                var test = $(e.target).closest('tr').data('FirstName');
            });


        });
    </script>
}
